<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Mappa del Mondo â€“ Confini cliccabili</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        background: #111;
        overflow: hidden;
    }
    canvas {
        display: block;
    }
    #label {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        background: rgba(0,0,0,0.7);
        color: white;
        font-family: Arial, sans-serif;
        font-size: 18px;
        border-radius: 8px;
        pointer-events: none;
    }
</style>
</head>
<body>

<canvas id="map"></canvas>
<div id="label">Clicca una nazione</div>

<script>
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");
const label = document.getElementById("label");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    draw();
}
window.addEventListener("resize", resize);
resize();

let countries = [];

// ðŸ”— GEOJSON MONDIALE AFFIDABILE
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>

<script>
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");
const label = document.getElementById("label");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    draw();
}
window.addEventListener("resize", resize);
resize();

let countries = [];

const TOPO_URL =
"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json";

Promise.all([
    fetch(TOPO_URL).then(r => r.json())
]).then(([world]) => {
    const geo = topojson.feature(world, world.objects.countries);
    countries = geo.features;
    draw();
}).catch(err => {
    console.error("ERRORE CARICAMENTO MAPPA", err);
});

function project([lon, lat]) {
    return [
        (lon + 180) / 360 * canvas.width,
        (90 - lat) / 180 * canvas.height
    ];
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // oceano
    ctx.fillStyle = "#1e3a8a";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if (!countries.length) return;

    ctx.strokeStyle = "#000";
    ctx.lineWidth = 0.5;

    countries.forEach(f => {
        const geom = f.geometry;
        ctx.beginPath();

        const drawPoly = poly => {
            poly.forEach(ring => {
                ring.forEach((p,i) => {
                    const [x,y] = project(p);
                    if(i===0) ctx.moveTo(x,y);
                    else ctx.lineTo(x,y);
                });
                ctx.closePath();
            });
        };

        if (geom.type === "Polygon") drawPoly(geom.coordinates);
        if (geom.type === "MultiPolygon")
            geom.coordinates.forEach(drawPoly);

        ctx.fillStyle = "#3b82f6";
        ctx.fill();
        ctx.stroke();
    });
}

// click
canvas.addEventListener("click", e => {
    const x = e.offsetX;
    const y = e.offsetY;

    for (let i = countries.length-1; i>=0; i--) {
        ctx.beginPath();
        const geom = countries[i].geometry;

        const drawPoly = poly => {
            poly.forEach(ring => {
                ring.forEach((p,j) => {
                    const [px,py] = project(p);
                    if(j===0) ctx.moveTo(px,py);
                    else ctx.lineTo(px,py);
                });
                ctx.closePath();
            });
        };

        if (geom.type==="Polygon") drawPoly(geom.coordinates);
        if (geom.type==="MultiPolygon")
            geom.coordinates.forEach(drawPoly);

        if (ctx.isPointInPath(x,y)) {
            label.textContent = "Nazione selezionata";
            return;
        }
    }
});
</script>


// HIT TEST (click su nazione)
canvas.addEventListener("click", e => {
    const x = e.offsetX;
    const y = e.offsetY;

    for (let i = countries.length - 1; i >= 0; i--) {
        const c = countries[i];
        ctx.beginPath();
        drawCountry(c);
        if (ctx.isPointInPath(x, y)) {
            const name =
                c.properties.ADMIN ||
                c.properties.NAME ||
                "Nazione sconosciuta";
            label.textContent = name;
            return;
        }
    }
});
</script>

</body>
</html>
